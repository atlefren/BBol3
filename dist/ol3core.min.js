/*! bbol3 28-11-2014 01:54 */

var BW=this.BW||{};BW.MapModel=BW.MapModel||{},BW.MapModel.Layer=function(a){"use strict";var b={subLayers:[],name:"",categoryId:0,visibleOnLoad:!0,isVisible:!1,isBaseLayer:!1,previewActive:!1,opacity:1,mapLayerIndex:-1,legendGraphicUrls:[]},c=$.extend({},b,a),d=_.map(a.subLayers,function(a){return new BW.MapModel.SubLayer(a)});return c.subLayers=d,c};var BW=this.BW||{};BW.MapModel=BW.MapModel||{},BW.MapModel.Map=function(){function a(){return void 0!==o?o.layers:[]}function b(){return a().filter(function(a){return a.isBaseLayer===!0})}function c(){return a().filter(function(a){return a.isBaseLayer===!1})}function d(){var a,d,e,f=0,g=b();for(a=0;a<g.length;a++)for(e=g[a],d=0;d<e.subLayers.length;d++)e.subLayers[d].layerIndex=f,f++;var h,i,j,k=c();for(h=0;h<k.length;h++)for(j=k[h],i=0;i<j.subLayers.length;i++)j.subLayers[i].layerIndex=f,f++}function e(a,b,c){p=b.proxyHost;var d=b.numZoomLevels,e=[];e[0]=b.newMaxRes;var f;for(f=1;d>f;f++)e[f]=e[f-1]/2;var g=new ol.proj.Projection({code:b.coordinate_system,extent:b.extent,units:b.extentUnits});m=new ol.Map({target:a,renderer:b.renderer,layers:[],view:new ol.View({projection:g,center:b.center,zoom:b.zoom,resolutions:e,maxResolution:b.newMaxRes,numZoomLevels:d}),controls:[],overlays:[]}),c&&c(m)}function f(){return b().filter(function(a){return a.isVisible===!0})}function g(a){var b,c;switch(a.source){case BW.MapModel.SubLayer.SOURCES.wmts:c=new BW.MapModel.Map.WmtsSource(a);break;case BW.MapModel.SubLayer.SOURCES.proxyWmts:a.url=p+a.url,c=new BW.MapModel.Map.WmtsSource(a);break;case BW.MapModel.SubLayer.SOURCES.wms:c=new BW.MapModel.Map.WmsSource(a);break;case BW.MapModel.SubLayer.SOURCES.proxyWms:a.url=p+a.url,c=new BW.MapModel.Map.WmsSource(a);break;default:throw"Unsupported source: BW.MapModel.SubLayer.SOURCES.'"+a.source+"'. For SubLayer with url "+a.url+" and name "+a.name+"."}return b=a.tiled?new ol.layer.Tile({extent:a.extent,opacity:a.opacity,source:c}):new ol.layer.Image({extent:a.extent,opacity:a.opacity,source:c}),b.layerIndex=a.layerIndex,b.guid=a.id,b}function h(a){var b,c,d,e=a.subLayers;for(b=0;b<e.length;b++)c=e[b],d=g(c),m.getLayers().insertAt(0,d);a.isVisible=!0}function i(a){h(a)}function j(a,c,f){o=c,n=c.layers,e(a,c,f),d();var g,h,j=b();for(g=0;g<j.length;g++)h=j[g],h.visibleOnLoad&&i(h)}function k(){return f()[0]}function l(a){var b,c;for(b=0;b<n.length;b++)if(c=n[b],c.id===a)return c}var m,n,o,p;return{Init:j,GetOverlayLayers:c,GetBaseLayers:b,GetLayerById:l,GetFirstVisibleBaseLayer:k,SetBaseLayer:i}},BW.MapModel.Map.WmtsSource=function(a){var b,c=new ol.proj.Projection({code:a.coordinate_system,extent:a.extent,units:a.extentUnits}),d=c.getExtent(),e=ol.extent.getWidth(d)/256,f=new Array(14),g=new Array(14),h=18;for(b=0;h>b;++b)f[b]=e/Math.pow(2,b),g[b]=c.getCode()+":"+b;return new ol.source.WMTS({url:a.url,layer:a.name,format:a.format,projection:c,matrixSet:a.coordinate_system,crossOrigin:"anonymous",tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(d),resolutions:f,matrixIds:g})})},BW.MapModel.Map.WmsSource=function(a){return a.tiled?new ol.source.TileWMS({params:{LAYERS:a.name,VERSION:"1.1.1"},url:a.url,format:a.format,crossOrigin:"anonymous",transparent:a.transparent}):new ol.source.ImageWMS({params:{LAYERS:a.name,VERSION:"1.1.1"},url:a.url,format:a.format,crossOrigin:"anonymous",transparent:a.transparent})};var BW=BW||{};BW.MapModel=BW.MapModel||{},BW.MapModel.SubLayer=function(a){var b={name:"",source:BW.MapModel.SubLayer.SOURCES.wmts,url:"",format:BW.MapModel.SubLayer.FORMATS.imagepng,coordinate_system:"",extent:[-1,1,-1,1],extentUnits:"m",transparent:!0,layerIndex:-1,isQueryable:!0},c=$.extend({},b,a);return c},BW.MapModel.SubLayer.SOURCES={wmts:"WMTS",wms:"WMS",vector:"VECTOR",proxyWmts:"proxyWmts",proxyWms:"proxyWms"},BW.MapModel.SubLayer.FORMATS={imagepng:"image/png",imagejpeg:"image/jpeg"};var BW=this.BW||{};BW.Repository=BW.Repository||{},function(a){"use strict";function b(a){var b={numZoomLevels:18,newMaxRes:21664,center:[-20617,7661666],zoom:4,extent:[-25e5,35e5,3045984,9045984],layers:[],tools:[]};_.extend(b,a);var c=_.map(a.layers,function(a){return new BW.MapModel.Layer(a)});return b.layers=c,b}var c=function(a){var b={numZoomLevels:10,newMaxRes:2e4,renderer:"canvas",center:[-1,1],zoom:5,layers:[],coordinate_system:"EPSG:32633",extent:[-1,-1,-1,-1],extentunits:"m",proxyHost:""};return _.extend({},b,a)};a.getConfig=function(a,d){function e(a){var e=new c(b(a));d(e)}try{e(_.isString(a)?JSON.parse(a):a)}catch(f){$.getJSON(a,function(a){e(a)})}}}(BW.Repository);var BW=this.BW||{};BW.MapCore=BW.MapCore||{},function(a){"use strict";a.setupMap=function(a,b,c){function d(b){e.Init(a,b,c)}var e=new BW.MapModel.Map(map);BW.Repository.getConfig(b,d)}}(BW.MapCore);
//# sourceMappingURL=ol3core.min.map